{% extends 'layout.html' %}

{% block content %}
    <section class="hero-section" id="about">
        <div class="hero-grid">
            <div class="hero-text">
                <div class="hero-top">
                    <!-- Typed Text -->
                    <h1 id="typed-text"></h1>
                </div>
                
                <div class="hero-bio-container">
                    <div class="hero-bio">
                        <p>
                            {{ about.bio }}
                        </p>
                        <p class="hero-connect">
                            <span style="font-weight: 600; color: var(--text-primary);">Connect:</span>
                            {% for social in social_media %}
                                <a href="{{ social.url }}" target="_blank" style="margin-right: 1rem;">{{ social.name }}</a>
                            {% endfor %}
                        </p>
                    </div>
                </div>
            </div>

            <div class="hero-visual">
                <!-- Animation Container behind image -->
                <div class="hero-animation">
                    <canvas id="organic-canvas"></canvas>
                </div>
                
                <!-- Sophisticated Minimal Black Hole -->
                <div class="black-hole-container">
                    <canvas id="bh-particles"></canvas>
                    <div class="black-hole-system" id="blackHole">
                        <div class="black-hole-core"></div>
                        <!-- Accretion Disks / Event Horizon Rings -->
                        <div class="accretion-disk disk-1"></div>
                        <div class="accretion-disk disk-2"></div>
                        <div class="accretion-disk disk-3"></div>
                        <!-- Photon Ring (The bright ring right at the edge) -->
                        <div class="photon-ring"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Skills Section -->
    <section class="skills-section">
        <h3>Technical Expertise</h3>
        <div class="skills-grid">
            {% for skill in skills %}
                <span class="skill-tag">{{ skill }}</span>
            {% endfor %}
        </div>
    </section>

    <section id="projects">
        <h2>Selected Work</h2>
        
        <div class="project-list">
            {% for project in projects %}
                <div class="project-card">
                    <div class="project-image">
                        <img src="{{ project.image | default('https://via.placeholder.com/800x600.png?text=Project+Image', true) }}" alt="{{ project.title }}">
                    </div>
                    <div class="project-content">
                        <h3>{{ project.title }}</h3>
                        <div class="tech-tags">
                            {% for tech in project.tech %}
                                <span>{{ tech }}</span>
                            {% endfor %}
                        </div>
                        <p>{{ project.description }}</p>
                        <a href="{{ project.url }}" class="project-link" target="_blank">View Project &rarr;</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>

    <section id="experience">
        <h2>Experience</h2>

        <div class="experience-list">
            {% for job in experiences %}
                <div class="experience-item">
                    <h3>{{ job.role }}</h3>
                    <h4>{{ job.company }} <span class="duration">&mdash; {{ job.duration }}</span></h4>
                    <p>{{ job.description }}</p>
                </div>
            {% endfor %}
        </div>
    </section>

    <!-- Quote Section -->
    {% if quote %}
    <section class="quote-section">
        <div class="quote-text">
            &ldquo;{{ quote.text }}&rdquo;
        </div>
        <div class="quote-author">
            &mdash; {{ quote.author }}
        </div>
    </section>
    {% endif %}

{% endblock %}


{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Typed.js Initialization ---
        if (document.getElementById('typed-text')) {
            var options = {
                strings: [
                    'Hello, I am Siddharth Bayapureddy.',
                    'I am a Python Developer.',
                    'I build ML/DL/AI models.',
                    'I turn ideas into code.'
                ],
                typeSpeed: 40,
                backSpeed: 20,
                backDelay: 1500,
                startDelay: 500,
                loop: true,
                smartBackspace: true,
                showCursor: true,
                cursorChar: '_',
                autoInsertCss: false
            };
            var typed = new Typed('#typed-text', options);
        }

        // --- Generative Organic Tree Animation (Canvas) ---
        const treeCanvas = document.getElementById('organic-canvas');
        if (treeCanvas) {
            const ctx = treeCanvas.getContext('2d');
            let width, height;
            
            function resizeTree() {
                const parent = treeCanvas.parentElement;
                width = parent.clientWidth;
                height = parent.clientHeight;
                treeCanvas.width = width;
                treeCanvas.height = height;
                startTreeAnimation();
            }
            // Debounce resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(resizeTree, 200);
            });
            
            class Branch {
                constructor(x, y, len, angle, width) {
                    this.x = x; this.y = y; this.len = len; this.angle = angle; this.width = width;
                    this.growLen = 0; this.growSpeed = (len / 40) + 0.5; this.finished = false; this.children = [];
                }
                update() {
                    if (this.growLen < this.len) this.growLen += this.growSpeed;
                    else {
                        this.growLen = this.len;
                        if (!this.finished) {
                            this.finished = true;
                            if (this.width > 0.5) {
                                const spread = 0.5 + Math.random() * 0.4;
                                const lenMult = 0.7 + Math.random() * 0.2;
                                this.children.push(new Branch(
                                    this.x + this.len * Math.sin(this.angle), this.y - this.len * Math.cos(this.angle),
                                    this.len * lenMult, this.angle - spread, this.width * 0.7
                                ));
                                this.children.push(new Branch(
                                    this.x + this.len * Math.sin(this.angle), this.y - this.len * Math.cos(this.angle),
                                    this.len * lenMult, this.angle + spread, this.width * 0.7
                                ));
                            }
                        }
                    }
                    this.children.forEach(c => c.update());
                }
                draw(ctx) {
                    const endX = this.x + this.growLen * Math.sin(this.angle);
                    const endY = this.y - this.growLen * Math.cos(this.angle);
                    ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(endX, endY);
                    ctx.lineWidth = this.width;
                    ctx.strokeStyle = 'rgba(196, 98, 67, 0.2)'; 
                    ctx.stroke();
                    this.children.forEach(c => c.draw(ctx));
                }
            }
            
            let root;
            function startTreeAnimation() {
                const startX = width * 0.9; 
                const startY = height * 0.9;
                root = new Branch(startX, startY, 70, 0.5, 3);
            }
            function animateTree() {
                ctx.clearRect(0, 0, width, height);
                if (root) { root.update(); root.draw(ctx); }
                requestAnimationFrame(animateTree);
            }
            resizeTree(); animateTree();
        }

        // --- Sophisticated Black Hole Particle System ---
        const bhCanvas = document.getElementById('bh-particles');
        const blackHoleElement = document.getElementById('blackHole');
        
        if (bhCanvas && blackHoleElement) {
            const ctx = bhCanvas.getContext('2d');
            let w, h;
            let particles = [];
            const particleCount = 150; // Dense field

            function resizeBH() {
                // Canvas should cover the hero visual area to allow particles to come from outside
                const container = bhCanvas.parentElement;
                w = container.clientWidth;
                h = container.clientHeight;
                bhCanvas.width = w;
                bhCanvas.height = h;
            }
            window.addEventListener('resize', resizeBH);
            resizeBH();

            class Particle {
                constructor() {
                    this.reset(true);
                }

                reset(initial = false) {
                    const cx = w / 2;
                    const cy = h / 2;
                    
                    // Start from random angle
                    this.angle = Math.random() * Math.PI * 2;
                    
                    // Distance: start outside the visible area or scattered if initial
                    if (initial) {
                        this.dist = 60 + Math.random() * (Math.max(w, h) / 2);
                    } else {
                        this.dist = Math.max(w, h) / 2 + Math.random() * 100;
                    }

                    this.speed = 0.5 + Math.random() * 1.5;
                    this.size = 1 + Math.random() * 2;
                    this.alpha = 0;
                }

                update() {
                    const cx = w / 2;
                    const cy = h / 2;

                    // Move towards center
                    this.dist -= this.speed;
                    
                    // Rotate (faster as it gets closer - conservation of angular momentum simulation)
                    this.angle += 0.002 + (50 / (this.dist + 10)) * 0.005;

                    this.x = cx + Math.cos(this.angle) * this.dist;
                    this.y = cy + Math.sin(this.angle) * this.dist;

                    // Opacity logic
                    if (this.dist < 60) {
                         // Fading out near event horizon
                         this.alpha -= 0.05;
                    } else if (this.alpha < 0.8) {
                         this.alpha += 0.01;
                    }

                    // Reset if too close or fully invisible near center
                    if (this.dist < 20 || (this.dist < 60 && this.alpha <= 0)) {
                        this.reset();
                    }
                }

                draw() {
                    if (this.alpha <= 0) return;
                    ctx.fillStyle = `rgba(196, 98, 67, ${this.alpha})`;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            function animateBH() {
                ctx.clearRect(0, 0, w, h);
                
                // Maintain particle count
                while (particles.length < particleCount) {
                    particles.push(new Particle());
                }

                particles.forEach(p => {
                    p.update();
                    p.draw();
                });

                requestAnimationFrame(animateBH);
            }

            // Emergence Animation - Staged for Story-telling
            setTimeout(() => {
                blackHoleElement.classList.add('emerged'); // Scales up & fades in
            }, 300); // Small delay before core emergence

            setTimeout(() => {
                // Activate accretion disks and photon ring (reveal them)
                const disksAndRing = document.querySelectorAll('.accretion-disk, .photon-ring');
                disksAndRing.forEach(el => el.classList.add('active'));
            }, 2500); // Disks appear after core has grown a bit (adjust based on core emergence duration)

            let bhAnimationStarted = false;
            function startBHAnimation() {
                if (!bhAnimationStarted) {
                    animateBH(); // Starts the particle animation loop
                    bhAnimationStarted = true;
                }
            }

            setTimeout(() => {
                startBHAnimation(); // Particles start flowing after disks are active
            }, 4000); // Adjust this delay for when particles should start. Should be after disks are visibly active.
        }
    });
</script>
{% endblock %}